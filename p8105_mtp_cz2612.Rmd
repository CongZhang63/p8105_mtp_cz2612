---
title: "Midterm project"
author: "Cong Zhang"
date: 2020-10-25
output: github_document
---

This is my solution to Midterm project.

```{r setup, message = FALSE}
library(tidyverse)
library(readxl)
library(patchwork)

knitr::opts_chunk$set(
	fig.width = 6, 
  fig.asp = .6,
  out.width = "90%"
)

theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```


## Problem 1

The raw data contain weights of three dogs of Jeff's friend. My goals are tidying the data, conducting some exploratory analysis, and making some plots to illustrate the data, in the hope of better understanding them.

First, let's take a look at the original excel file. In order to import the data, the first row need to be omitted. We should also convert the date of weights from a character variable to a date variable. The abnormal date "s", introduced by data entry mistakes, should be dropped. There are also some data entry mistakes with weights variables. They are measured in Lbs and Oz, but both figures are stored in the same cell. Therefore, we need to separate these figures, and convert them into a single figure measured in Lbs.

Second, we import and tidy the dog weights data. After importing the data and cleaning the variable names, we convert the date and weights variables mentioned before. Moreover, the character variable notes are dropped, following the instructions. Furthermore, one observation with abnormal date and three observations without any non-missing weight values are deleted for subsequent analysis.

```{r dogweights_stat_df}
dogweights_stat_df = 
  read_xlsx(
		"./data/dogweights_07sept2020.xlsx",
		skip = 1) %>% 
  janitor::clean_names() %>%
  separate(raisin, into = c("raisin_lb", "raisin_oz"), sep = 2) %>% 
  separate(simone, into = c("simone_lb", "simone_oz"), sep = 2) %>% 
  separate(gagne, into = c("gagne_lb", "gagne_oz"), sep = 2) %>% 
  separate(std, into = c("std_lb", "std_oz"), sep = 2) %>%  
  mutate(
    date = as.numeric(date),
    date = as.Date(date, origin = "1899-12-30"),
    raisin_lb = as.numeric(raisin_lb) + as.numeric(raisin_oz) / 16,
    simone_lb = as.numeric(simone_lb) + as.numeric(simone_oz) / 16,
    gagne_lb = as.numeric(gagne_lb) + as.numeric(gagne_oz) / 16,
    std_lb = as.numeric(std_lb) + as.numeric(std_oz) / 16,
  ) %>% 
  select(date, raisin_lb, simone_lb, gagne_lb, std_lb) %>% 
  filter(!is.na(date)) %>% 
  filter(!(is.na(raisin_lb) & is.na(simone_lb) & is.na(gagne_lb)))
```

Third, we create a second dataframe with notes and their corresponding dates. Therefore, only the observations with valid notes values are kept.

```{r dogweights_notes_df}
dogweights_notes_df = 
  read_xlsx(
		"./data/dogweights_07sept2020.xlsx",
		skip = 1) %>% 
  janitor::clean_names() %>%
  select(date, notes = x6) %>% 
  mutate(
    date = as.numeric(date),
    date = as.Date(date, origin = "1899-12-30"),
  ) %>% 
  filter(!is.na(notes))
```

Finally, we export these newly generated dataframes as CSVs, and store them in the same directory as the raw data.
```{r}
write_csv(dogweights_stat_df,"./data/dogweights_stat.csv")
write_csv(dogweights_notes_df,"./data/dogweights_notes.csv")
```



## Problem 2

The resulting tidy weights dataset contains the following `r ncol(dogweights_stat_df)` variables: `r names(dogweights_stat_df)`. It has `r nrow(dogweights_stat_df)` observations, and the dimension is `r nrow(dogweights_stat_df)` x `r ncol(dogweights_stat_df)`. There are `r n_distinct(pull(dogweights_stat_df,date))` unique dates included in the tidy dataset. There are `r sum(is.na(pull(dogweights_stat_df,date)))` missing date,  `r sum(is.na(pull(dogweights_stat_df,raisin_lb)))` missing raisin_lb,  `r sum(is.na(pull(dogweights_stat_df,simone_lb)))` missing simone_lb,  `r sum(is.na(pull(dogweights_stat_df,gagne_lb)))` missing gagne_lb, `r sum(is.na(pull(dogweights_stat_df,std_lb)))` missing std_lb.

Now, let's create the summary table regarding the number of observations for each dog, along with their average weight and the standard deviation. All the figured are measured in Lbs.

```{r}
dogweights_stat_df %>% 
  select(raisin_lb:gagne_lb) %>% 
  pivot_longer(
    raisin_lb:gagne_lb,
    names_to = "name",
    values_to = "weight"
  ) %>% 
  mutate(
    name = str_replace(name, "raisin_lb", "Raisin"),
    name = str_replace(name, "simone_lb", "Simone"),
    name = str_replace(name, "gagne_lb", "Gagne"),
    ) %>% 
  group_by(name) %>% 
  summarize(
    weight_obs = sum(!is.na(weight)),
    weight_avg = mean(weight, na.rm = TRUE),
    weight_sd = sd(weight, na.rm = TRUE)
  ) %>% 
  knitr::kable(digits = 2)
```



## Problem 3

Let's Make some plots to illustrate our tidy dog weights data.

```{r}
weight_distr_plot =
  dogweights_stat_df %>% 
  select(date, raisin_lb:gagne_lb) %>% 
  pivot_longer(
    raisin_lb:gagne_lb,
    names_to = "name",
    values_to = "weight"
  ) %>% 
  mutate(
    name = str_replace(name, "raisin_lb", "Raisin"),
    name = str_replace(name, "simone_lb", "Simone"),
    name = str_replace(name, "gagne_lb", "Gagne"),
    name = as.factor(name),
    name = fct_reorder(name, weight)
  ) %>%
  ggplot(aes(x = name, y = weight, color = name)) +
  geom_boxplot() +
  labs(
    title = "Dog’s weight distribution",
    x = "Dog's name",
    y = "Weight (lb)",
    caption = "Data from the dogweights_07sept2020.xlsx file"
  ) +
  scale_color_hue(name = "Dog's name")

weight_time_plot =
  dogweights_stat_df %>% 
  select(date, raisin_lb:gagne_lb) %>% 
  pivot_longer(
    raisin_lb:gagne_lb,
    names_to = "name",
    values_to = "weight"
  ) %>% 
  mutate(
    name = str_replace(name, "raisin_lb", "Raisin"),
    name = str_replace(name, "simone_lb", "Simone"),
    name = str_replace(name, "gagne_lb", "Gagne"),
    name = as.factor(name),
    name = fct_reorder(name, weight)
  ) %>%
  ggplot(aes(x = date, y = weight, color = name)) +
  geom_point() +
  geom_smooth() +
  labs(
    title = "Dog’s weight over time",
    x = "Date",
    y = "Weight (lb)",
    caption = "Data from the dogweights_07sept2020.xlsx file"
  ) +
  scale_color_hue(name = "Dog's name")

weight_distr_plot + weight_time_plot
```

From the graphs, we could see that Raisin is the heaviest dog, while Simone is the lightest one. We could also find out that the weights of Raisin and Simone slowly decreased first, and then gradually increased. However, generally speaking, Gagne's weight was decreasing till its death. 

```{r word_count, message = FALSE}
wordcountaddin::text_stats("p8105_mtp_cz2612.Rmd")
```

